<h1 class="mt-4">Account</h1>
{{> messages}}
<p class="lead mb-3">Welcome {{name}}</p>
<a href="/user/logout" class="btn btn-secondary">Logout</a>
<br><br>

<input class="form-control no-border" type="number" id="TotalReturn" placeholder="Total Return" readonly>

<div class="table-responsive mt-3" style="border-radius: 1em;">
    <table class="table table-dark table-borderless table-striped">
        <thead>
            <tr>
                <th scope="col" name="currency">CurrencyID</th>
                <th scope="col">Purchase Date</th>
                <th scope="col">Cost Per</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total</th>
                <th scope="col">Quantity to sell</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            {{#each history}}
            <form action="sellCrypto" method="POST">
                <tr>
                    <td scope="row">{{this.crypto_currency}}</td>
                    <td scope="row">{{this.dateFormat}}</td>
                    <td scope="row">${{this.us_dollar}}</td>
                    <td scope="row">{{this.coin_count}}</td>
                    <td scope="row">${{this.total}}</td>
                    <td scope="row">
                        <input class="form-control bg-secondary text-light" id="sellQuantity" name="sellQuantity"
                            type="number" min="0">
                    </td>
                    <td scope="row">
                        <button class="btn btn-secondary form-control">Sell</button>
                    </td>                 
                </tr>
                <!-- hidden values! created for each object -->
                <input type="hidden" name="crypto_currency" id="crypto_currency" value="{{this.crypto_currency}}">
                <input type="hidden" name="quantity" id="quantity" value="{{this.coin_count}}">
                <input type="hidden" name="us_dollar" id="cost" value="{{this.us_dollar}}">
                <input type="hidden" name="unique_id" id="unique_id" value="{{this._id}}">
                <input type="hidden" name="purchase_date" id="purchase_date" value="{{this.purchase_date}}">
                <input type="hidden" name="purchase_date" id="loss" class="loss" value="{{this.loss}}">
                <input type="hidden" name="purchase_date" id="gain" class="gain" value="{{this.gain}}">
            </form>
            {{/each}}
        </tbody>
    </table>
</div>
<!--Uses client side java to get the total return value.-->
 <script>
     var elements = document.getElementsByClassName("loss");
     var gainElement=document.getElementsByClassName("gain");
     var totalLoss=0;
     var lossVal = 0;
     var totalGains=0;
     var gainVal=0;
for (var i = 0, len = elements.length; i < len; i++) {
    lossVal=parseFloat(elements[i].value);
    gainVal=parseFloat(gainElement[i].value);
    if (isNaN(lossVal)){
         totalLoss += 0;
        }
    else{
        totalLoss-=lossVal;
    }
        if (isNaN(gainVal)){
         totalGains += 0;
        }
    else{
        totalGains+=gainVal;
    }
}
//after looping through and summing each of the gains and losses, we subtract total losses from total gains to provide a "portfolio value" or "return on investment"
    var total=parseFloat(totalGains)-parseFloat(totalLoss);
    document.getElementById("TotalReturn").value=parseFloat(total);
 </script>
